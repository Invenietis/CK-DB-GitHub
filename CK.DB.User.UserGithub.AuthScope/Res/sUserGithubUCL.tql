-- SetupConfig: { "AddRequires" : "CK.sAuthScopeSetCopy" }
--
-- The ScopeSetId is intrinsic.
-- A new ScopeSetId is only set when a new UserGithub is created,
-- but it is not editable: it does not appear in the parameters and does not
-- participate in updates.
--
create transformer on CK.sUserGithubUCL
as
begin

	inject "
		-- The ScopeSetId is intrinsic.
		-- A new ScopeSetId is only set when a new User Github is created.
		declare @DefaultScopeSetId int;
		select @DefaultScopeSetId = ScopeSetId from CK.tUserGithub where UserId = 0;
		declare @NewScopeSetId int;
		exec CK.sAuthScopeSetCopy @ActorId, @DefaultScopeSetId, 'W', @NewScopeSetId output;"
	into "PreCreate";
		
	in single part {insert into CK.tUserGithub}
	begin
		add column ScopeSetId = @NewScopeSetId;
	end

end
